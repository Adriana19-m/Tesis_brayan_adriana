<form id="cita_form">
    {% csrf_token %}
    <input type="hidden" name="id_cita" value="{{ cita.id_cita|default:'' }}">
    
    <div class="row">
        <div class="col-md-6">
            <div class="form-group mb-3">
                {% if is_paciente %}
                    {# Si es paciente, no mostrar campo editable; incluir hidden con su id #}
                    <input type="hidden" id="id_paciente" name="id_paciente" value="{{ user_id }}">
                    <label class="form-label">Paciente</label>
                    <input type="text" class="form-control" value="{{ request.user.get_full_name }} (ID: {{ user_id }})" readonly>
                {% else %}
                    <label for="id_paciente" class="form-label">Paciente (ID)</label>
                    <input type="text" id="id_paciente" name="id_paciente" class="form-control" 
                           value="{{ cita.id_paciente.id|default:'' }}" required>
                    <small class="form-text text-muted">Ingrese el ID numérico del paciente</small>
                {% endif %}
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label for="id_doctor" class="form-label">Doctor (ID)</label>
                <input type="text" id="id_doctor" name="id_doctor" class="form-control" 
                       value="{{ cita.id_doctor.id|default:'' }}" required>
                <small class="form-text text-muted">Ingrese el ID numérico del doctor</small>
            </div>
        </div>
    </div>

    <div class="form-group mb-3">
        <label for="fecha_hora" class="form-label">Fecha y Hora</label>
        <input type="datetime-local" id="fecha_hora" name="fecha_hora" class="form-control" 
               value="{% if cita.fecha_hora %}{{ cita.fecha_hora|date:'Y-m-d\\TH:i' }}{% endif %}" required>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label for="tipo_cita" class="form-label">Tipo de Cita</label>
                <select name="tipo_cita" id="tipo_cita" class="form-control">
                    <option value="PRESENCIAL" {% if cita.tipo_cita == 'PRESENCIAL' %}selected{% endif %}>PRESENCIAL</option>
                    <option value="TELECONSULTA" {% if cita.tipo_cita == 'TELECONSULTA' %}selected{% endif %}>TELECONSULTA</option>
                    <option value="DOMICILIO" {% if cita.tipo_cita == 'DOMICILIO' %}selected{% endif %}>DOMICILIO</option>
                    <option value="OTRO" {% if cita.tipo_cita == 'OTRO' %}selected{% endif %}>OTRO</option>
                </select>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label for="estado" class="form-label">Estado</label>
                <select name="estado" id="estado" class="form-control" {% if is_paciente %}disabled{% endif %}>
                    <option value="PENDIENTE" {% if cita.estado == 'PENDIENTE' %}selected{% endif %}>PENDIENTE</option>
                    <option value="CONFIRMADA" {% if cita.estado == 'CONFIRMADA' %}selected{% endif %}>CONFIRMADA</option>
                    <option value="ATENDIDA" {% if cita.estado == 'ATENDIDA' %}selected{% endif %}>ATENDIDA</option>
                    <option value="CANCELADA" {% if cita.estado == 'CANCELADA' %}selected{% endif %}>CANCELADA</option>
                    <option value="NO_ASISTE" {% if cita.estado == 'NO_ASISTE' %}selected{% endif %}>NO_ASISTE</option>
                    <option value="REPROGRAMADA" {% if cita.estado == 'REPROGRAMADA' %}selected{% endif %}>REPROGRAMADA</option>
                </select>
            </div>
        </div>
    </div>

    <div class="form-group mb-3">
        <label for="motivo" class="form-label">Motivo</label>
        <textarea name="motivo" id="motivo" class="form-control" rows="3">{{ cita.motivo|default:'' }}</textarea>
    </div>

    <div class="form-group mb-3">
        <label for="observaciones" class="form-label">Observaciones</label>
        <textarea name="observaciones" id="observaciones" class="form-control" rows="2">{{ cita.observaciones|default:'' }}</textarea>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" class="btn btn-primary">Guardar</button>
    </div>
</form>
