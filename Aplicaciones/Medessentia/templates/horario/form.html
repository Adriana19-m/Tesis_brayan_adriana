<form id="horario_form">
    {% csrf_token %}
    <input type="hidden" name="id_horario" value="{{ horario.id_horario|default:'' }}">
    
    <div class="form-group mb-3">
        <label for="id_doctor" class="form-label">Doctor</label>
        <select name="id_doctor" id="id_doctor" class="form-control" required 
                {% if is_doctor and not is_admin %}disabled{% endif %}>
            <option value="">Seleccionar Doctor</option>
            {% for doctor in doctores %}
            <option value="{{ doctor.id }}" 
                    {% if horario.id_doctor.id == doctor.id %}selected{% endif %}
                    {% if is_doctor and not is_admin and request.user.id != doctor.id %}disabled{% endif %}>
                {{ doctor.first_name }} {{ doctor.last_name }}
            </option>
            {% endfor %}
        </select>
        {% if is_doctor and not is_admin %}
        <input type="hidden" name="id_doctor" value="{{ request.user.id }}">
        {% endif %}
    </div>

    <div class="form-group mb-3">
        <label for="dia_semana" class="form-label">Día de la Semana</label>
        <select name="dia_semana" id="dia_semana" class="form-control" required>
            <option value="">Seleccionar día</option>
            <option value="Lunes" {% if horario.dia_semana == 'Lunes' %}selected{% endif %}>Lunes</option>
            <option value="Martes" {% if horario.dia_semana == 'Martes' %}selected{% endif %}>Martes</option>
            <option value="Miercoles" {% if horario.dia_semana == 'Miercoles' %}selected{% endif %}>Miércoles</option>
            <option value="Jueves" {% if horario.dia_semana == 'Jueves' %}selected{% endif %}>Jueves</option>
            <option value="Viernes" {% if horario.dia_semana == 'Viernes' %}selected{% endif %}>Viernes</option>
            <option value="Sabado" {% if horario.dia_semana == 'Sabado' %}selected{% endif %}>Sábado</option>
            <option value="Domingo" {% if horario.dia_semana == 'Domingo' %}selected{% endif %}>Domingo</option>
        </select>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label for="hora_inicio" class="form-label">Hora Inicio</label>
                <input type="time" id="hora_inicio" name="hora_inicio" class="form-control" 
                       value="{% if horario.hora_inicio %}{{ horario.hora_inicio|time:'H:i' }}{% endif %}" required>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label for="hora_fin" class="form-label">Hora Fin</label>
                <input type="time" id="hora_fin" name="hora_fin" class="form-control" 
                       value="{% if horario.hora_fin %}{{ horario.hora_fin|time:'H:i' }}{% endif %}" required>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" class="btn btn-primary">Guardar</button>
    </div>
</form>

<script>
    // Validación en tiempo real para hora_inicio < hora_fin
    document.getElementById('hora_inicio').addEventListener('change', validarHoras);
    document.getElementById('hora_fin').addEventListener('change', validarHoras);

    function validarHoras() {
        const inicio = document.getElementById('hora_inicio').value;
        const fin = document.getElementById('hora_fin').value;
        
        if (inicio && fin && inicio >= fin) {
            alert('La hora de inicio debe ser menor que la hora de fin');
            document.getElementById('hora_fin').value = '';
        }
    }
</script>